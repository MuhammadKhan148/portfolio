;/*FB_PKG_DELIM*/

__d("IGDLegacyTLCBundleResource",["IGDLegacyTLCMainWebWorkerResource"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=c("IGDLegacyTLCMainWebWorkerResource")}),98);
__d("MAWLSDataSyncMiddleware",["FBLogger","MAWBridge","MAWLSEditMsgHistoryAddedDataSyncHandler","MAWLSMsgsDataSync","MAWLSReactionsDataSyncHandler","getErrorSafe","qex"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function i(){var a=new Set();c("qex")._("4298")&&a.add(d("MAWLSReactionsDataSyncHandler").mawLSReactionsDataSyncHandler);c("qex")._("4380")&&a.add(d("MAWLSEditMsgHistoryAddedDataSyncHandler").mawLSEditHistoryDataSyncHandler);c("qex")._("4486")&&a.add(d("MAWLSMsgsDataSync").mawLSMsgsDataSyncHandler);a.forEach(function(a){h.set(a.tableName,a)})}function j(a){return babelHelpers["extends"]({},a,{mutate:function(b){var c=h.get(a.name);return c!=null?c.performAndSyncMutation(b,a):a.mutate(b)}})}function a(){i();return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return h.has(b)?j(a.table(b)):a.table(b)}})}catch(d){var b=c("getErrorSafe")(d);c("FBLogger")("maw_db").catching(b).mustfix("Error applying MAW to LS data sync middleware");return a}},name:"MAWLSDataSyncMiddleware",stack:"dbcore"}}function b(a){d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[a]})}g.getMAWLSDataSyncMiddleware=a;g.syncToLS=b}),98);
__d("MAWLSEditMsgHistoryAddedDataSyncHandler",["MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=a.map(function(a){return babelHelpers["extends"]({},a)});d("MAWLSDataSyncMiddleware").syncToLS({tag:"EditMsgHistoryAdded",value:a})}a={performAndSyncMutation:function(a,b){switch(a.type){case"put":case"add":var c=[].concat(a.values);d("MAWIndexedDb").afterTransactionEffect(function(){return h(c)});break}return b.mutate(a)},tableName:"editMsgHistory"};g.mawLSEditHistoryDataSyncHandler=a}),98);
__d("MAWLSMsgsDataSync",["MAWBridgeTypesCreators","MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=b.keys;b=b.trans;return a.getMany({keys:c,trans:b}).then(function(a){return a.filter(Boolean)})}function i(a){a=a.reduce(function(a,b){var c=d("MAWBridgeTypesCreators").createBridgeDeletedMessage(b);a.has(b.threadJid)||a.set(b.threadJid,[]);(b=a.get(b.threadJid))==null?void 0:b.push(c);return a},new Map());a.entries().forEach(function(a){var b=a[0];a=a[1];a={messages:a,threadJid:b};d("MAWLSDataSyncMiddleware").syncToLS({tag:"DeleteMessages",value:a})})}a={performAndSyncMutation:function(a,b){switch(a.type){case"delete":return h(b,a).then(function(c){d("MAWIndexedDb").afterTransactionEffect(function(){return i(c)});return b.mutate(a)});default:return b.mutate(a)}},tableName:"messages"};g.mawLSMsgsDataSyncHandler=a}),98);
__d("MAWLSReactionsDataSyncHandler",["MAWBridgeTypesCreators","MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.author,c=a.reaction,e=a.reactToMsgId,f=a.threadJid;a=a.ts;if(e==null)return;d("MAWLSDataSyncMiddleware").syncToLS({tag:"UpsertReaction",value:d("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:b,chatJid:f,reaction:c||"",reactToMsgId:e,ts:a})})}function i(a){var b=a.author,c=a.reactToMsgId;a=a.threadJid;if(c==null)return;d("MAWLSDataSyncMiddleware").syncToLS({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:a,reactToMsgId:c})})}function j(a){a.forEach(function(a){a.reaction==null?i(a):h(a)})}a={performAndSyncMutation:function(a,b){switch(a.type){case"put":case"add":var c=[].concat(a.values);d("MAWIndexedDb").afterTransactionEffect(function(){return j(c)});break}return b.mutate(a)},tableName:"reactions"};g.mawLSReactionsDataSyncHandler=a}),98);